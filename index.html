<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#0b1220" />
    <title>PWA C√°mara</title>

    <link rel="manifest" href="manifest.json" />
    <link rel="icon" href="images/icons/192.png" />

    <style>
        :root {
            /* Estas variables se recalculan desde JS con el tama√±o real del video */
            --frame-w: 420px;
            --frame-h: 315px;
            /* 4:3 por defecto */
            --bg: #0b1220;
            --panel: #0f182d;
            --border: #1f2a44;
            --muted: #93a4c3;
            --fg: #e6edf3;
            --accent: #0ea5e9;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            background: var(--bg);
            color: var(--fg);
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        }

        header {
            position: sticky;
            top: 0;
            z-index: 10;
            background: linear-gradient(180deg, #0c152b 0%, rgba(12, 21, 43, 0.8) 70%, transparent 100%);
            padding: 16px 16px 8px;
            backdrop-filter: blur(6px);
            border-bottom: 1px solid #0d1a33;
        }

        .container {
            padding: 16px;
            max-width: 980px;
            margin: 0 auto;
        }

        h1 {
            margin: 0 0 6px;
            font-size: 1.25rem;
            letter-spacing: .2px;
        }

        .hint {
            color: var(--muted);
            font-size: .95rem;
            margin: 0;
        }

        .toolbar {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 14px 0;
        }

        button {
            padding: 10px 14px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: #111a33;
            color: var(--fg);
            font-weight: 600;
            cursor: pointer;
            transition: transform .08s ease, background .15s ease, box-shadow .15s ease;
            box-shadow: 0 1px 0 rgba(0, 0, 0, .25), 0 6px 12px rgba(0, 0, 0, .15) inset;
        }

        button:hover {
            background: #152143;
        }

        button:active {
            transform: translateY(1px);
        }

        .primary {
            background: var(--accent);
            color: #09111f;
            border-color: var(--accent);
            box-shadow: none;
        }

        .danger {
            background: #92272a;
            border-color: #a43a3e;
        }

        /* Marco de la c√°mara: estas dimensiones se replican en la galer√≠a */
        .frame {
            width: var(--frame-w);
            height: var(--frame-h);
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 24px rgba(0, 0, 0, .35);
        }

        .stage {
            display: none;
        }

        .stage.active {
            display: block;
        }

        video {
            width: 100%;
            height: 100%;
            display: block;
            background: #000;
            object-fit: contain;
        }

        /* Galer√≠a HORIZONTAL (NO carrusel, sin snap: solo scroll libre) */
        .gallery-wrap {
            margin-top: 16px;
        }

        .gallery-head {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .gallery {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 16px;
            background: var(--panel);
        }

        .gallery::-webkit-scrollbar {
            height: 10px;
        }

        .gallery::-webkit-scrollbar-thumb {
            background: #223055;
            border-radius: 999px;
        }

        /* Cada item de galer√≠a con EXACTAMENTE la MISMA dimensi√≥n visual que la c√°mara */
        .thumb {
            position: relative;
            flex: 0 0 auto;
            width: var(--frame-w);
            height: var(--frame-h);
            border: 1px solid var(--border);
            border-radius: 14px;
            overflow: hidden;
            background: #0b1220;
            box-shadow: 0 8px 18px rgba(0, 0, 0, .28);
        }

        .thumb img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #000;
            display: block;
        }

        /* Bot√≥n de descargar superpuesto (no altera el alto del thumb) */
        .thumb a.dl {
            position: absolute;
            right: 10px;
            bottom: 10px;
            padding: 6px 10px;
            font-weight: 600;
            text-decoration: none;
            color: var(--fg);
            background: #111a33;
            border: 1px solid var(--border);
            border-radius: 10px;
        }

        /* Responsive: que no desborde en pantallas chicas */
        .frame,
        .thumb {
            max-width: calc(100vw - 48px);
        }
    </style>
</head>

<body>
    <header>
        <div class="container">
            <h1>üì∑ PWA de C√°mara</h1>
            <p class="hint">Galer√≠a con el <strong>mismo tama√±o</strong> que la vista de la c√°mara. Scroll horizontal
                libre (NO carrusel).</p>
        </div>
    </header>

    <main class="container">
        <div class="toolbar">
            <button id="openCamera" class="primary">Abrir c√°mara</button>
            <button id="takePhoto">Tomar foto</button>
            <button id="switchCamera">Cambiar a frontal</button>
            <button id="clearGallery" class="danger">Limpiar</button>
        </div>

        <section id="cameraContainer" class="stage">
            <div class="frame">
                <video id="video" autoplay playsinline></video>
            </div>
        </section>

        <!-- Canvas oculto solo para generar blobs/urls -->
        <canvas id="canvas" width="320" height="240" hidden></canvas>

        <section class="gallery-wrap">
            <div class="gallery-head">
                <h2 style="margin:0;font-size:1.05rem;">Galer√≠a</h2>
                <span class="hint">Scroll horizontal ‚Ä¢ URLs temporales (blob:)</span>
            </div>
            <div id="gallery" class="gallery" role="list" aria-label="Galer√≠a de capturas"></div>
        </section>
    </main>

    <script src="app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js').catch(console.error);
        }
    </script>
</body>

</html>